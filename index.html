let expired = false;

// --- EXPIRATION SECTION ---
const expirationEl = document.getElementById("expiration");
if (data.expiration_date) {
  const expirationDate = new Date(data.expiration_date);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const expNormalized = new Date(expirationDate);
  expNormalized.setHours(0, 0, 0, 0);

  const formatted = expirationDate.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  if (expNormalized.getTime() === today.getTime()) {
    expirationEl.classList.add("warning");
    expirationEl.innerText = `⚠️ These date options expire TODAY (${formatted}). Please respond immediately.`;
  } else if (expNormalized.getTime() < today.getTime()) {
    expirationEl.classList.add("expired");
    expirationEl.innerText = `❌ These date options have expired (${formatted}). Please contact your rep to request new dates.`;
    expired = true;
  } else {
    expirationEl.innerText = `These date options expire on ${formatted}.`;
  }
} else {
  expirationEl.style.display = "none";
}

// --- DATE SELECTION BUTTONS ---
const container = document.getElementById("dates");
container.innerHTML = "";

["date_offered_1", "date_offered_2", "date_offered_3"].forEach((key) => {
  const val = data[key];
  if (val) {
    const dateOnly = val.split("T")[0];
    const btn = document.createElement("button");
    btn.innerText = dateOnly;

    if (expired) {
      btn.disabled = true;
      btn.title = "These dates have expired.";
      btn.style.opacity = 0.5;
      btn.style.cursor = "not-allowed";
    } else {
      btn.onclick = () => submitSelection(key, dealId);
    }

    container.appendChild(btn);
  }
});
